# spring cloud 脚手架

### 包含内容有
* Spring cloud eureka server
* Spring cloud eureka client
### eureka
Eureka是一个基于REST (Representational State Transfer)的服务，主要用于AWS云中定位服务，
以实现中间层服务器的负载平衡和故障转移。
我们称之为Eureka服务器。Eureka还附带了一个基于java的客户端组件，即Eureka客户端，它使与服务的交互更加容易。
客户端还有一个内置的负载均衡器，可以执行基本的循环负载平衡。在Netflix，
一个更复杂的负载平衡器包装了Eureka，提供基于流量、资源使用、错误条件等几个因素的加权负载平衡，以提供优越的弹性。

项目中简单的实现了Eureka的集群配置，多Eureka客户端配置，还有Eureka消费者的配置。
调费者模块中使用了 RestTemplate 的 方式调用服务
调费者模块中使用了 Feign 的 方式调用服务

Zookeeper保证的是CP
Eureka则是AP

Zookeeper保证CP
当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，
但不能接受服务直接down掉不可用。也就是说，服务注册功能对可用性的要求要高于一致性。但是zk会出现这样一种情况，
当master节点因为网络故障与其他节点失去联系时，剩余节点会重新进行leader选举。
问题在于，选举leader的时间太长，30 ~ 120s, 且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。
在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的事，虽然服务能够最终恢复，
但是漫长的选举时间导致的注册长期不可用是不能容忍的。

Eureka保证AP
Eureka看主要看重了CP所解决不了的问题，因此在设计时就优先保证可用性。
Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。
而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，
就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)。除此之外，Eureka还有一种自我保护机制，
如果在15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：

* Eureka不再从注册列表中移除因为长时间没收到心跳而应该过期的服务
* Eureka仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上(即保证当前节点依然可用)
* 当网络稳定时，当前实例新的注册信息会被同步到其它节点中

因此， Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像zookeeper那样使整个注册服务瘫痪